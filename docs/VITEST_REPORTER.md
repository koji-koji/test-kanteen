# Vitest Custom Reporter

Test Kanteenã®Vitestã‚«ã‚¹ã‚¿ãƒ ãƒ¬ãƒãƒ¼ã‚¿ãƒ¼ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œæ™‚æƒ…å ±ï¼ˆå®Ÿè¡Œæ™‚é–“ã€æˆåŠŸ/å¤±æ•—ã€ã‚¨ãƒ©ãƒ¼è©³ç´°ï¼‰ã‚’å–å¾—ã§ãã¾ã™ã€‚

## ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
npm install @koji-koji/test-kanteen
```

## åŸºæœ¬çš„ãªä½¿ã„æ–¹

### vitest.config.tsã§ã®è¨­å®š

```typescript
// vitest.config.ts
import { defineConfig } from 'vitest/config';

export default defineConfig({
  test: {
    reporters: [
      'default', // Vitestæ¨™æº–ãƒ¬ãƒãƒ¼ã‚¿ãƒ¼ã‚’ç¶­æŒ
      ['@koji-koji/test-kanteen/vitest', {
        output: './test-kanteen-runtime',
        format: ['json', 'markdown'],
        verbose: false
      }]
    ]
  }
});
```

### JavaScriptã§ã®è¨­å®š

```javascript
// vitest.config.js
import { defineConfig } from 'vitest/config';

export default defineConfig({
  test: {
    reporters: [
      'default',
      ['@koji-koji/test-kanteen/vitest', {
        output: './test-kanteen-runtime',
        format: ['json', 'markdown'],
        verbose: false
      }]
    ]
  }
});
```

## ã‚ªãƒ—ã‚·ãƒ§ãƒ³

| ã‚ªãƒ—ã‚·ãƒ§ãƒ³ | å‹ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ | èª¬æ˜ |
|-----------|-----|-----------|------|
| `output` | `string` | `'./test-kanteen-runtime'` | å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª |
| `format` | `string[]` | `['json', 'markdown']` | å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ (`json`, `markdown`) |
| `verbose` | `boolean` | `false` | è©³ç´°ãƒ­ã‚°ã‚’è¡¨ç¤º |

## å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ

### JSONå½¢å¼ (`runtime-catalog.json`)

```json
{
  "metadata": {
    "version": "0.5.0",
    "generatedAt": "2025-11-15T10:30:00.000Z",
    "executionDate": "2025-11-15T10:29:55.000Z",
    "totalDuration": 5234,
    "sourceFiles": ["tests/math.test.ts"],
    "framework": "vitest",
    "toolVersion": "0.5.0"
  },
  "testSuites": [
    {
      "id": "suite-1",
      "name": "Math",
      "filePath": "tests/math.test.ts",
      "runtime": {
        "duration": 523
      },
      "tests": [
        {
          "id": "test-1",
          "name": "should add two numbers",
          "location": {
            "file": "tests/math.test.ts",
            "line": 10,
            "column": 3
          },
          "runtime": {
            "duration": 45,
            "status": "passed"
          }
        },
        {
          "id": "test-2",
          "name": "should handle errors",
          "location": {
            "file": "tests/math.test.ts",
            "line": 15,
            "column": 3
          },
          "runtime": {
            "duration": 12,
            "status": "failed",
            "error": {
              "message": "expect(received).toBe(expected)\n\nExpected: 3\nReceived: 2",
              "stack": "Error: Expected 2 to equal 3\n    at Object.<anonymous> (/tests/math.test.ts:16:5)",
              "matcherName": "toBe",
              "expected": "3",
              "actual": "2"
            }
          }
        }
      ]
    }
  ],
  "executionSummary": {
    "totalTests": 2,
    "passed": 1,
    "failed": 1,
    "skipped": 0,
    "pending": 0,
    "todo": 0,
    "totalDuration": 57,
    "startTime": "2025-11-15T10:29:55.000Z",
    "endTime": "2025-11-15T10:29:55.057Z"
  }
}
```

### Markdownå½¢å¼ (`runtime-catalog.md`)

````markdown
# Runtime Test Catalog (Vitest)

> Generated by Test Kanteen v0.5.0

## Metadata

- **Generated At**: 11/15/2025, 10:30:00 AM
- **Execution Date**: 11/15/2025, 10:29:55 AM
- **Total Duration**: 5234ms
- **Source Files**: 1

## Execution Summary

- **Total Tests**: 2
- **Passed**: 1 âœ…
- **Failed**: 1 âŒ
- **Skipped**: 0 â­ï¸
- **Pending**: 0 â¸ï¸
- **Todo**: 0 ğŸ“

## Test Results

**Math** (523ms)
  - âœ… should add two numbers (45ms)
  - âŒ should handle errors (12ms)
    - âŒ Error: expect(received).toBe(expected)

Expected: 3
Received: 2
````

## å®Ÿè¡Œä¾‹

### 1. ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ

```bash
npm run test
# ã¾ãŸã¯
vitest
```

### 2. å‡ºåŠ›ã‚’ç¢ºèª

```bash
ls test-kanteen-runtime/
# runtime-catalog.json
# runtime-catalog.md
```

### 3. JSONå½¢å¼ã§ç¢ºèª

```bash
cat test-kanteen-runtime/runtime-catalog.json | jq '.executionSummary'
```

## ASTã‚«ã‚¿ãƒ­ã‚°ã¨ã®æ¯”è¼ƒ

Test Kanteenã¯ã€ASTãƒ™ãƒ¼ã‚¹ã®ã‚«ã‚¿ãƒ­ã‚°ã¨ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚«ã‚¿ãƒ­ã‚°ã®ä¸¡æ–¹ã‚’ç”Ÿæˆã§ãã¾ã™:

```bash
# 1. ASTã‚«ã‚¿ãƒ­ã‚°ã‚’ç”Ÿæˆ
npx kanteen analyze "tests/**/*.test.ts"

# 2. ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚«ã‚¿ãƒ­ã‚°ã‚’ç”Ÿæˆï¼ˆVitestã§å®Ÿè¡Œï¼‰
vitest

# 3. æ¯”è¼ƒï¼ˆPhase 5ã§å®Ÿè£…äºˆå®šï¼‰
npx kanteen compare \
  ./aaa_test_kanteen/catalog.json \
  ./test-kanteen-runtime/runtime-catalog.json
```

### ASTã¨ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã®é•ã„

| é …ç›® | ASTã‚«ã‚¿ãƒ­ã‚° | ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚«ã‚¿ãƒ­ã‚° |
|------|------------|--------------------|
| å–å¾—æ–¹æ³• | ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰è§£æ | ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ |
| å®Ÿè¡Œæ™‚é–“ | âŒ | âœ… |
| æˆåŠŸ/å¤±æ•— | âŒ | âœ… |
| ã‚¨ãƒ©ãƒ¼è©³ç´° | âŒ | âœ… |
| ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ | âœ… | âŒ |
| å‹•çš„ç”Ÿæˆãƒ†ã‚¹ãƒˆ | âŒ | âœ… (test.eachç­‰) |

## é«˜åº¦ãªä½¿ã„æ–¹

### è©³ç´°ãƒ­ã‚°ã®æœ‰åŠ¹åŒ–

```typescript
// vitest.config.ts
import { defineConfig } from 'vitest/config';

export default defineConfig({
  test: {
    reporters: [
      'default',
      ['@koji-koji/test-kanteen/vitest', {
        output: './test-kanteen-runtime',
        format: ['json', 'markdown'],
        verbose: true  // è©³ç´°ãƒ­ã‚°ã‚’æœ‰åŠ¹åŒ–
      }]
    ]
  }
});
```

å®Ÿè¡Œæ™‚ã®å‡ºåŠ›:
```
[Kanteen] Vitest Reporter initialized
[Kanteen] Output: ./test-kanteen-runtime
[Kanteen] Format: json, markdown
[Kanteen] Test run started
[Kanteen] Processed 5 tasks from /path/to/math.test.ts
[Kanteen] Processed 3 tasks from /path/to/string.test.ts
[Kanteen] Test run completed
[Kanteen] Total tests: 8
[Kanteen] Passed: 7
[Kanteen] Failed: 1
[Kanteen] Duration: 150ms
[Kanteen] JSON catalog written to: ./test-kanteen-runtime/runtime-catalog.json
[Kanteen] Markdown catalog written to: ./test-kanteen-runtime/runtime-catalog.md
```

### JSONå½¢å¼ã®ã¿ã§å‡ºåŠ›

```typescript
// vitest.config.ts
import { defineConfig } from 'vitest/config';

export default defineConfig({
  test: {
    reporters: [
      'default',
      ['@koji-koji/test-kanteen/vitest', {
        output: './test-kanteen-runtime',
        format: ['json']  // Markdownã¯ç”Ÿæˆã—ãªã„
      }]
    ]
  }
});
```

### ã‚¦ã‚©ãƒƒãƒãƒ¢ãƒ¼ãƒ‰ã§ã®ä½¿ç”¨

```bash
vitest --watch
```

ã‚¦ã‚©ãƒƒãƒãƒ¢ãƒ¼ãƒ‰ã§ã‚‚ã€ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ™‚ã«è‡ªå‹•çš„ã«ã‚«ã‚¿ãƒ­ã‚°ãŒæ›´æ–°ã•ã‚Œã¾ã™ã€‚

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚¨ãƒ©ãƒ¼: Cannot find module 'vitest'

**åŸå› **: `vitest`ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ãªã„

**è§£æ±ºç­–**:
```bash
npm install --save-dev vitest
```

### å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«ãŒç”Ÿæˆã•ã‚Œãªã„

**ç¢ºèªäº‹é …**:
1. ãƒ†ã‚¹ãƒˆãŒå®Ÿéš›ã«å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
2. `output`ãƒ‘ã‚¹ãŒæ­£ã—ã„ã‹ç¢ºèª
3. `verbose: true`ã§è©³ç´°ãƒ­ã‚°ã‚’ç¢ºèª

### TypeScriptå‹ã‚¨ãƒ©ãƒ¼

**è§£æ±ºç­–**: å‹å®šç¾©ã‚’ç¢ºèª
```typescript
import { defineConfig } from 'vitest/config';

const config = defineConfig({
  test: {
    reporters: [
      'default',
      ['@koji-koji/test-kanteen/vitest' as any, {
        // ...options
      }]
    ]
  }
});

export default config;
```

### ãƒã‚¹ãƒˆã•ã‚ŒãŸã‚¹ã‚¤ãƒ¼ãƒˆãŒæ­£ã—ãè¡¨ç¤ºã•ã‚Œãªã„

**ç¢ºèªäº‹é …**:
- `describe`ã®ãƒã‚¹ãƒˆãŒæ­£ã—ã„ã‹ç¢ºèª
- `verbose: true`ã§ãƒ­ã‚°ã‚’ç¢ºèªã—ã€suite pathãŒæ­£ã—ã„ã‹ç¢ºèª

## CI/CDçµ±åˆ

### GitHub Actions

```yaml
name: Test with Kanteen

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: '20'

      - run: npm ci
      - run: npm run test

      - name: Upload test catalog
        uses: actions/upload-artifact@v4
        with:
          name: test-kanteen-runtime
          path: test-kanteen-runtime/
```

### GitLab CI

```yaml
test:
  script:
    - npm ci
    - npm run test
  artifacts:
    paths:
      - test-kanteen-runtime/
    expire_in: 1 week
```

## Vitestã®æ©Ÿèƒ½ã¨ã®äº’æ›æ€§

### test.each / describe.each

å‹•çš„ã«ç”Ÿæˆã•ã‚Œã‚‹ãƒ†ã‚¹ãƒˆã‚‚æ­£ã—ãã‚­ãƒ£ãƒ—ãƒãƒ£ã•ã‚Œã¾ã™:

```typescript
describe.each([
  { a: 1, b: 1, expected: 2 },
  { a: 2, b: 2, expected: 4 },
])('addition', ({ a, b, expected }) => {
  it(`should add ${a} + ${b} = ${expected}`, () => {
    expect(a + b).toBe(expected);
  });
});
```

ã“ã‚Œã‚‰ã¯å®Ÿè¡Œæ™‚ã«ã‚«ã‚¿ãƒ­ã‚°ã«è¿½åŠ ã•ã‚Œã¾ã™ã€‚

### test.skip / test.todo

ã‚¹ã‚­ãƒƒãƒ—ã‚„TODOãƒãƒ¼ã‚¯ã•ã‚ŒãŸãƒ†ã‚¹ãƒˆã‚‚æ­£ã—ãè¨˜éŒ²ã•ã‚Œã¾ã™:

```typescript
test.skip('not implemented yet', () => {
  // ã“ã®ãƒ†ã‚¹ãƒˆã¯ã‚¹ã‚­ãƒƒãƒ—ã•ã‚Œã€ã‚«ã‚¿ãƒ­ã‚°ã«è¨˜éŒ²ã•ã‚Œã‚‹
});

test.todo('implement later');
// TODOã¨ã—ã¦ã‚«ã‚¿ãƒ­ã‚°ã«è¨˜éŒ²ã•ã‚Œã‚‹
```

## Jestãƒ¬ãƒãƒ¼ã‚¿ãƒ¼ã¨ã®é•ã„

| æ©Ÿèƒ½ | Jest Reporter | Vitest Reporter |
|------|--------------|-----------------|
| ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ãƒ•ãƒƒã‚¯ | onRunStart, onTestResult, onRunComplete | onInit, onTaskUpdate, onFinished |
| ã‚¿ã‚¹ã‚¯æ§‹é€  | Flat (testResults array) | Hierarchical (nested tasks) |
| ã‚¹ã‚¤ãƒ¼ãƒˆæƒ…å ± | ancestorTitlesé…åˆ— | task.suite chain |
| ã‚¨ãƒ©ãƒ¼æƒ…å ± | failureMessages, failureDetails | result.errors |

## åˆ¶é™äº‹é …

- Vitest 1.0.0ä»¥é™ãŒå¿…è¦ï¼ˆ2.0.0æ¨å¥¨ï¼‰
- Node.js 18.0.0ä»¥é™ãŒå¿…è¦
- ä¸¦åˆ—å®Ÿè¡Œæ™‚ã®ãƒ¯ãƒ¼ã‚«ãƒ¼æƒ…å ±ã¯ç¾åœ¨æœªå¯¾å¿œ

## é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [README.md](../README.md) - åŸºæœ¬çš„ãªä½¿ã„æ–¹
- [JEST_REPORTER.md](./JEST_REPORTER.md) - Jestãƒ¬ãƒãƒ¼ã‚¿ãƒ¼
- [LLMæ´»ç”¨ã‚¬ã‚¤ãƒ‰](./LLM_GUIDE.md) - LLMã‚’ä½¿ã£ãŸé«˜åº¦ãªåˆ†æ
- [CHANGELOG.md](../CHANGELOG.md) - å¤‰æ›´å±¥æ­´

## ã‚µãƒãƒ¼ãƒˆ

å•é¡ŒãŒç™ºç”Ÿã—ãŸå ´åˆ:
- [GitHub Issues](https://github.com/koji-koji/test-kanteen/issues)
- [Discussion](https://github.com/koji-koji/test-kanteen/discussions)
