# Playwright Custom Reporter

Test Kanteenã®Playwrightã‚«ã‚¹ã‚¿ãƒ ãƒ¬ãƒãƒ¼ã‚¿ãƒ¼ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œæ™‚æƒ…å ±ï¼ˆå®Ÿè¡Œæ™‚é–“ã€æˆåŠŸ/å¤±æ•—ã€ã‚¨ãƒ©ãƒ¼è©³ç´°ï¼‰ã‚’å–å¾—ã§ãã¾ã™ã€‚

## ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
npm install @koji-koji/test-kanteen
```

## åŸºæœ¬çš„ãªä½¿ã„æ–¹

### playwright.config.tsã§ã®è¨­å®š

```typescript
// playwright.config.ts
import { defineConfig } from '@playwright/test';

export default defineConfig({
  reporter: [
    ['list'], // Playwrightæ¨™æº–ãƒ¬ãƒãƒ¼ã‚¿ãƒ¼ã‚’ç¶­æŒ
    ['@koji-koji/test-kanteen/playwright', {
      output: './test-kanteen-runtime',
      format: ['json', 'markdown'],
      verbose: false
    }]
  ],
  // ... ãã®ä»–ã®è¨­å®š
});
```

### JavaScriptã§ã®è¨­å®š

```javascript
// playwright.config.js
const { defineConfig } = require('@playwright/test');

module.exports = defineConfig({
  reporter: [
    ['list'],
    ['@koji-koji/test-kanteen/playwright', {
      output: './test-kanteen-runtime',
      format: ['json', 'markdown'],
      verbose: false
    }]
  ],
});
```

## ã‚ªãƒ—ã‚·ãƒ§ãƒ³

| ã‚ªãƒ—ã‚·ãƒ§ãƒ³ | å‹ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ | èª¬æ˜ |
|-----------|-----|-----------|------|
| `output` | `string` | `'./test-kanteen-runtime'` | å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª |
| `format` | `string[]` | `['json', 'markdown']` | å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ (`json`, `markdown`) |
| `verbose` | `boolean` | `false` | è©³ç´°ãƒ­ã‚°ã‚’è¡¨ç¤º |

## å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ

### JSONå½¢å¼ (`runtime-catalog.json`)

```json
{
  "metadata": {
    "version": "0.5.0",
    "generatedAt": "2025-11-15T10:30:00.000Z",
    "executionDate": "2025-11-15T10:29:55.000Z",
    "totalDuration": 5234,
    "sourceFiles": ["tests/example.spec.ts"],
    "framework": "playwright",
    "toolVersion": "0.5.0"
  },
  "testSuites": [
    {
      "id": "suite-1",
      "name": "Example Test Suite",
      "filePath": "tests/example.spec.ts",
      "runtime": {
        "duration": 523
      },
      "tests": [
        {
          "id": "test-1",
          "name": "should pass",
          "location": {
            "file": "tests/example.spec.ts",
            "line": 10,
            "column": 3
          },
          "runtime": {
            "duration": 45,
            "status": "passed"
          }
        },
        {
          "id": "test-2",
          "name": "should fail",
          "location": {
            "file": "tests/example.spec.ts",
            "line": 15,
            "column": 3
          },
          "runtime": {
            "duration": 12,
            "status": "failed",
            "error": {
              "message": "expect(received).toBe(expected)\n\nExpected: 'hello'\nReceived: 'world'",
              "stack": "Error: ...",
              "matcherName": "toBe",
              "expected": "'hello'",
              "actual": "'world'"
            }
          }
        }
      ]
    }
  ],
  "executionSummary": {
    "totalTests": 2,
    "passed": 1,
    "failed": 1,
    "skipped": 0,
    "pending": 0,
    "todo": 0,
    "totalDuration": 57,
    "startTime": "2025-11-15T10:29:55.000Z",
    "endTime": "2025-11-15T10:29:55.057Z"
  }
}
```

### Markdownå½¢å¼ (`runtime-catalog.md`)

````markdown
# Runtime Test Catalog (Playwright)

> Generated by Test Kanteen v0.5.0

## Metadata

- **Generated At**: 11/15/2025, 10:30:00 AM
- **Execution Date**: 11/15/2025, 10:29:55 AM
- **Total Duration**: 5234ms
- **Source Files**: 1

## Execution Summary

- **Total Tests**: 2
- **Passed**: 1 âœ…
- **Failed**: 1 âŒ
- **Skipped**: 0 â­ï¸
- **Pending**: 0 â¸ï¸
- **Todo**: 0 ğŸ“

## Test Results

**Example Test Suite** (523ms)
  - âœ… should pass (45ms)
  - âŒ should fail (12ms)
    - âŒ Error: expect(received).toBe(expected)

Expected: 'hello'
Received: 'world'
````

## å®Ÿè¡Œä¾‹

### 1. ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ

```bash
npx playwright test
```

### 2. å‡ºåŠ›ã‚’ç¢ºèª

```bash
ls test-kanteen-runtime/
# runtime-catalog.json
# runtime-catalog.md
```

### 3. JSONå½¢å¼ã§ç¢ºèª

```bash
cat test-kanteen-runtime/runtime-catalog.json | jq '.executionSummary'
```

## ASTã‚«ã‚¿ãƒ­ã‚°ã¨ã®æ¯”è¼ƒ

Test Kanteenã¯ã€ASTãƒ™ãƒ¼ã‚¹ã®ã‚«ã‚¿ãƒ­ã‚°ã¨ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚«ã‚¿ãƒ­ã‚°ã®ä¸¡æ–¹ã‚’ç”Ÿæˆã§ãã¾ã™:

```bash
# 1. ASTã‚«ã‚¿ãƒ­ã‚°ã‚’ç”Ÿæˆ
npx kanteen analyze "tests/**/*.spec.ts"

# 2. ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚«ã‚¿ãƒ­ã‚°ã‚’ç”Ÿæˆï¼ˆPlaywrightã§å®Ÿè¡Œï¼‰
npx playwright test

# 3. æ¯”è¼ƒï¼ˆPhase 5ã§å®Ÿè£…äºˆå®šï¼‰
npx kanteen compare \
  ./aaa_test_kanteen/catalog.json \
  ./test-kanteen-runtime/runtime-catalog.json
```

### ASTã¨ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã®é•ã„

| é …ç›® | ASTã‚«ã‚¿ãƒ­ã‚° | ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚«ã‚¿ãƒ­ã‚° |
|------|------------|--------------------|
| å–å¾—æ–¹æ³• | ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰è§£æ | ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ |
| å®Ÿè¡Œæ™‚é–“ | âŒ | âœ… |
| æˆåŠŸ/å¤±æ•— | âŒ | âœ… |
| ã‚¨ãƒ©ãƒ¼è©³ç´° | âŒ | âœ… |
| ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ | âœ… | âŒ |
| ãƒ–ãƒ©ã‚¦ã‚¶æƒ…å ± | âŒ | âœ… (Playwright) |

## é«˜åº¦ãªä½¿ã„æ–¹

### è©³ç´°ãƒ­ã‚°ã®æœ‰åŠ¹åŒ–

```typescript
// playwright.config.ts
import { defineConfig } from '@playwright/test';

export default defineConfig({
  reporter: [
    ['list'],
    ['@koji-koji/test-kanteen/playwright', {
      output: './test-kanteen-runtime',
      format: ['json', 'markdown'],
      verbose: true  // è©³ç´°ãƒ­ã‚°ã‚’æœ‰åŠ¹åŒ–
    }]
  ],
});
```

å®Ÿè¡Œæ™‚ã®å‡ºåŠ›:
```
[Kanteen] Playwright Reporter initialized
[Kanteen] Output: ./test-kanteen-runtime
[Kanteen] Format: json, markdown
[Kanteen] Test run started
[Kanteen] Projects: 3
[Kanteen] Test completed: should navigate to homepage (passed)
[Kanteen] Test completed: should login successfully (passed)
[Kanteen] Test completed: should show error for invalid credentials (failed)
[Kanteen] Test run completed
[Kanteen] Total tests: 15
[Kanteen] Passed: 13
[Kanteen] Failed: 2
[Kanteen] Duration: 12345ms
[Kanteen] JSON catalog written to: ./test-kanteen-runtime/runtime-catalog.json
[Kanteen] Markdown catalog written to: ./test-kanteen-runtime/runtime-catalog.md
```

### JSONå½¢å¼ã®ã¿ã§å‡ºåŠ›

```typescript
// playwright.config.ts
import { defineConfig } from '@playwright/test';

export default defineConfig({
  reporter: [
    ['list'],
    ['@koji-koji/test-kanteen/playwright', {
      output: './test-kanteen-runtime',
      format: ['json']  // Markdownã¯ç”Ÿæˆã—ãªã„
    }]
  ],
});
```

### ç‰¹å®šã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã¿

```typescript
// playwright.config.ts
import { defineConfig } from '@playwright/test';

export default defineConfig({
  projects: [
    {
      name: 'chromium',
      use: { browserName: 'chromium' },
    },
    {
      name: 'firefox',
      use: { browserName: 'firefox' },
    },
  ],
  reporter: [
    ['list'],
    ['@koji-koji/test-kanteen/playwright', {
      output: './test-kanteen-runtime',
      format: ['json', 'markdown'],
    }]
  ],
});
```

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚¨ãƒ©ãƒ¼: Cannot find module '@playwright/test'

**åŸå› **: `@playwright/test`ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ãªã„

**è§£æ±ºç­–**:
```bash
npm install --save-dev @playwright/test
```

### å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«ãŒç”Ÿæˆã•ã‚Œãªã„

**ç¢ºèªäº‹é …**:
1. ãƒ†ã‚¹ãƒˆãŒå®Ÿéš›ã«å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
2. `output`ãƒ‘ã‚¹ãŒæ­£ã—ã„ã‹ç¢ºèª
3. `verbose: true`ã§è©³ç´°ãƒ­ã‚°ã‚’ç¢ºèª

### TypeScriptå‹ã‚¨ãƒ©ãƒ¼

**è§£æ±ºç­–**: å‹å®šç¾©ã‚’ç¢ºèª
```typescript
import { defineConfig } from '@playwright/test';

const config = defineConfig({
  reporter: [
    ['list'],
    ['@koji-koji/test-kanteen/playwright' as any, {
      // ...options
    }]
  ],
});

export default config;
```

### ãƒã‚¹ãƒˆã•ã‚ŒãŸã‚¹ã‚¤ãƒ¼ãƒˆãŒæ­£ã—ãè¡¨ç¤ºã•ã‚Œãªã„

**ç¢ºèªäº‹é …**:
- `test.describe`ã®ãƒã‚¹ãƒˆãŒæ­£ã—ã„ã‹ç¢ºèª
- `verbose: true`ã§ãƒ­ã‚°ã‚’ç¢ºèªã—ã€suite pathãŒæ­£ã—ã„ã‹ç¢ºèª

## CI/CDçµ±åˆ

### GitHub Actions

```yaml
name: Playwright Tests with Kanteen

on: [push, pull_request]

jobs:
  test:
    timeout-minutes: 60
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: '20'

      - run: npm ci
      - run: npx playwright install --with-deps
      - run: npx playwright test

      - name: Upload test catalog
        uses: actions/upload-artifact@v4
        with:
          name: test-kanteen-runtime
          path: test-kanteen-runtime/

      - name: Upload Playwright report
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: playwright-report
          path: playwright-report/
```

### GitLab CI

```yaml
playwright:
  image: mcr.microsoft.com/playwright:latest
  script:
    - npm ci
    - npx playwright install
    - npx playwright test
  artifacts:
    when: always
    paths:
      - test-kanteen-runtime/
      - playwright-report/
    expire_in: 1 week
```

## Playwrightã®æ©Ÿèƒ½ã¨ã®äº’æ›æ€§

### test.describe.parallel

ä¸¦åˆ—å®Ÿè¡Œã•ã‚Œã‚‹ãƒ†ã‚¹ãƒˆã‚‚æ­£ã—ãã‚­ãƒ£ãƒ—ãƒãƒ£ã•ã‚Œã¾ã™:

```typescript
test.describe.parallel('Parallel Suite', () => {
  test('test 1', async ({ page }) => {
    // ã“ã‚Œã‚‰ã¯ä¸¦åˆ—å®Ÿè¡Œã•ã‚Œã¾ã™ãŒã€å…¨ã¦è¨˜éŒ²ã•ã‚Œã¾ã™
  });

  test('test 2', async ({ page }) => {
    // ...
  });
});
```

### test.skip / test.fixme

ã‚¹ã‚­ãƒƒãƒ—ã‚„fixmeãƒãƒ¼ã‚¯ã•ã‚ŒãŸãƒ†ã‚¹ãƒˆã‚‚æ­£ã—ãè¨˜éŒ²ã•ã‚Œã¾ã™:

```typescript
test.skip('not implemented yet', async ({ page }) => {
  // ã“ã®ãƒ†ã‚¹ãƒˆã¯ã‚¹ã‚­ãƒƒãƒ—ã•ã‚Œã€ã‚«ã‚¿ãƒ­ã‚°ã«è¨˜éŒ²ã•ã‚Œã‚‹
});

test.fixme('needs fixing', async ({ page }) => {
  // fixmeã¨ã—ã¦ã‚¹ã‚­ãƒƒãƒ—ã•ã‚Œã€ã‚«ã‚¿ãƒ­ã‚°ã«è¨˜éŒ²ã•ã‚Œã‚‹
});
```

### test.only

ãƒ‡ãƒãƒƒã‚°ç”¨ã®`test.only`ã‚‚æ­£ã—ãå‹•ä½œã—ã¾ã™:

```typescript
test.only('debug this test', async ({ page }) => {
  // ã“ã®ãƒ†ã‚¹ãƒˆã®ã¿å®Ÿè¡Œã•ã‚Œã€ã‚«ã‚¿ãƒ­ã‚°ã«è¨˜éŒ²ã•ã‚Œã‚‹
});
```

### Retries

ãƒªãƒˆãƒ©ã‚¤æ©Ÿèƒ½ã¨ã‚‚äº’æ›æ€§ãŒã‚ã‚Šã¾ã™ã€‚æœ€å¾Œã®å®Ÿè¡ŒçµæœãŒã‚«ã‚¿ãƒ­ã‚°ã«è¨˜éŒ²ã•ã‚Œã¾ã™ã€‚

```typescript
// playwright.config.ts
export default defineConfig({
  retries: 2, // æœ€å¤§2å›ãƒªãƒˆãƒ©ã‚¤
  reporter: [
    ['list'],
    ['@koji-koji/test-kanteen/playwright', { /* ... */ }]
  ],
});
```

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ»ãƒ–ãƒ©ã‚¦ã‚¶å¯¾å¿œ

Playwrightã®è¤‡æ•°ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ©Ÿèƒ½ã«ã‚‚å¯¾å¿œã—ã¦ã„ã¾ã™:

```typescript
// playwright.config.ts
export default defineConfig({
  projects: [
    { name: 'chromium', use: { browserName: 'chromium' } },
    { name: 'firefox', use: { browserName: 'firefox' } },
    { name: 'webkit', use: { browserName: 'webkit' } },
  ],
  reporter: [
    ['list'],
    ['@koji-koji/test-kanteen/playwright', {
      output: './test-kanteen-runtime'
    }]
  ],
});
```

å…¨ã¦ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ†ã‚¹ãƒˆçµæœãŒ1ã¤ã®ã‚«ã‚¿ãƒ­ã‚°ã«çµ±åˆã•ã‚Œã¾ã™ã€‚

## ä»–ã®ãƒ¬ãƒãƒ¼ã‚¿ãƒ¼ã¨ã®é•ã„

| æ©Ÿèƒ½ | Jest Reporter | Vitest Reporter | Playwright Reporter |
|------|--------------|-----------------|---------------------|
| ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ãƒ•ãƒƒã‚¯ | onRunStart, onTestResult, onRunComplete | onInit, onTaskUpdate, onFinished | onBegin, onTestEnd, onEnd |
| ãƒ–ãƒ©ã‚¦ã‚¶æƒ…å ± | âŒ | âŒ | âœ… (ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå) |
| ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆæ¤œå‡º | âŒ | âŒ | âœ… (timedOut status) |
| ãƒªãƒˆãƒ©ã‚¤å¯¾å¿œ | âŒ | âŒ | âœ… |

## åˆ¶é™äº‹é …

- Playwright 1.40.0ä»¥é™ãŒå¿…è¦
- Node.js 18.0.0ä»¥é™ãŒå¿…è¦
- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ»ãƒ–ãƒ©ã‚¦ã‚¶æƒ…å ±ã¯ç¾åœ¨è¨˜éŒ²ã•ã‚Œã¾ã›ã‚“ï¼ˆå°†æ¥ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§å¯¾å¿œäºˆå®šï¼‰
- ãƒªãƒˆãƒ©ã‚¤ã•ã‚ŒãŸãƒ†ã‚¹ãƒˆã¯æœ€å¾Œã®å®Ÿè¡Œçµæœã®ã¿è¨˜éŒ²ã•ã‚Œã¾ã™

## é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [README.md](../README.md) - åŸºæœ¬çš„ãªä½¿ã„æ–¹
- [JEST_REPORTER.md](./JEST_REPORTER.md) - Jestãƒ¬ãƒãƒ¼ã‚¿ãƒ¼
- [VITEST_REPORTER.md](./VITEST_REPORTER.md) - Vitestãƒ¬ãƒãƒ¼ã‚¿ãƒ¼
- [LLMæ´»ç”¨ã‚¬ã‚¤ãƒ‰](./LLM_GUIDE.md) - LLMã‚’ä½¿ã£ãŸé«˜åº¦ãªåˆ†æ
- [CHANGELOG.md](../CHANGELOG.md) - å¤‰æ›´å±¥æ­´

## ã‚µãƒãƒ¼ãƒˆ

å•é¡ŒãŒç™ºç”Ÿã—ãŸå ´åˆ:
- [GitHub Issues](https://github.com/koji-koji/test-kanteen/issues)
- [Discussion](https://github.com/koji-koji/test-kanteen/discussions)
